/*
 *This code is a mashup between the TrinketKeyboard from adafruit
 *and the ps/2 keyboard lib, with a bit of changes to both
 *
 *code by Mario Avenoso, mario@mtechcreations.com
 */
#define kbd_es_es
#include "DigiKeyboard.h"
#include <PS2Keyboard.h>

const int DataPin = 0;//8;//pin is 0
const int IRQpin =  2;//1;//not a pin but the interupt, pin is 2

const static uint8_t  HIDTable[] =  {
  0x00, // 0
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x2A,0x32,0x32, // 10
  0x00,0x00,0x28,0x00,0x00,0x00,0x00,0x00,0x33,0x33, // 20
  0x00,0x00,0x00,0x00,0x00,0x00,0x29,0x00,0x00,0x00, // 30
  0x00,0x2c,0x1e,0x1f,0x20,0x21,0x22,0x23,0x2d,0x25,
  0x26,0x30,0x30,0x36,0x38,0x37,0x24,0x27,0x1e,0x1f,
  0x20,0x21,0x22,0x23,0x24,0x25,0x26,0x37,0x36,0x64,
  0x27,0x64,0x2d,0x1f,0x04,0x05,0x06,0x07,0x08,0x09,
  0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,0x12,0x13,
  0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,0x1c,0x1d,
  0x2f,0x35,0x30,0x2f,0x38,0x2f,0x04,0x05,0x06,0x07,
  0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f,0x10,0x11,
  0x12,0x13,0x14,0x15,0x16,0x17,0x18,0x19,0x1a,0x1b,
  0x1c,0x1d,0x34,0x1e,0x32,0x21,0x2c // 127
};

const static uint8_t  MODTable[] =  {
  0x00, // 0
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02, // 10
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02, // 20
  0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00, // 30
  0x00,0x00,0x02,0x02,0x40,0x02,0x02,0x02,0x00,0x02,
  0x02,0x02,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x02,0x00,
  0x02,0x02,0x02,0x40,0x02,0x02,0x02,0x02,0x02,0x02,
  0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,
  0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,
  0x40,0x40,0x40,0x02,0x02,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x40,0x40,0x40,0x40,0x00 // 127
};

PS2Keyboard keyboard;

void setup()
{
delay(1000);

keyboard.begin(DataPin,IRQpin );
//setup_keymaps();


}

void loop()
{

if (keyboard.available()) {

uint8_t c = keyboard.read();
uint8_t k = HIDTable[c];
uint8_t m = MODTable[c];


if ( c == 0xC3 ) {
  
  c = keyboard.read();
  

if ( c == 0xA1 ){ c = 0x61 ;DigiKeyboard.sendKeyStroke(0x34);}
else if ( c == 0xA9 ){  c = 0x65 ;DigiKeyboard.sendKeyStroke(0x34);}
else if ( c == 0xAD ){  c = 0x69 ;DigiKeyboard.sendKeyStroke(0x34);}
else if ( c == 0xB3 ){  c = 0x6f ;DigiKeyboard.sendKeyStroke(0x34);}
else if ( c == 0xBA ){  c = 0x75 ;DigiKeyboard.sendKeyStroke(0x34);}

else if (c == 0x81 ) { c = 0x41 ;DigiKeyboard.sendKeyStroke(0x34);}
else if (c == 0x89 ) { c = 0x45 ;DigiKeyboard.sendKeyStroke(0x34);}
else if (c == 0x8D ) { c = 0x49 ;DigiKeyboard.sendKeyStroke(0x34);}
else if (c == 0x93 ) { c = 0x4f ;DigiKeyboard.sendKeyStroke(0x34);}
else if (c == 0x9A ) { c = 0x55 ;DigiKeyboard.sendKeyStroke(0x34);}


else if ( c == 0xBC ){  c = 0x75 ;DigiKeyboard.sendKeyStroke(0x34),2;}
else if ( c == 0x9C ){  c = 0x55 ;DigiKeyboard.sendKeyStroke(0x34),2;}



else if ( c == 0xB1 ) { c = 19 ;  }
else if ( c == 0x91 ) { c = 20 ;  }

else if ( c == 0xA7 ) { c = 9 ;  }
else if ( c == 0x87 ) { c = 10 ;  }


}


  
DigiKeyboard.sendKeyStroke(k,m);

  }

}


